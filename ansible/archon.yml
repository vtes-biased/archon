---
- name: Deploy the Archon beta website on archon.vekn.net
  hosts: vekn
  become: true
  gather_facts: false
  vars:
    username: ubuntu
    service_name: archon_web
    domain_name: archon.vekn.net
    postgresql_version: "16"
    site_root: "/home/{{ username }}/projects/{{ service_name }}"
    db_name: archondb
    db_user: archon
    db_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65613831323539356463366262303338653230373533656361303938633264393332356231636336
      3437643137333136376463396631393962653566373064370a636366393464616638653335633166
      32383431376436666662613839323163313964363964613365366336633564353736383563623936
      6431373237613065360a636261366535333965363539623038343034633836613739313233613334
      30346335613532353537353165626565623962623134373865313535663762313961656530356563
      33663838613964303833633332326663386461653032303133633765343838643431616537313764
      37656639343563626364343361376234373761643566306466363166626439336537383061356139
      38653137356537633565
  roles:
    - role: register-tls
    - role: postgres
    - role: fastapi-backend
      package: vtes-archon
      asgi_entrypoint: "archon.app.main:app"
      open_location: "/api"
      service_port: 8001
      env_vars:
          PYTHONOPTIMIZE: 1
          SITE_URL_BASE: "https://{{ domain_name }}"
          DB_NAME:  "{{ db_name }}"
          DB_USER:  "{{ db_user }}"
          DB_PWD: "{{ db_password }}"
          MAIL_SERVER: "smtp.gmail.com"
          MAIL_PORT: "587"
          MAIL_USERNAME: "codex.of.the.damned@gmail.com"
          MAIL_FROM: "codex.of.the.damned@gmail.com"
          MAIL_FROM_NAME: "Archon Online"
          VEKN_LOGIN: archon_vekn
          DISCORD_CLIENT_ID: "1381856472161456139"
          TOKEN_SECRET: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            62656238653333386464636434336436646263656362633433363263633236306665653230616661
            3430643735336236343666393861326432623639663264610a316163616636383966356538356639
            64656636346532636335356264653564306365666565663730303364663763666235343566393535
            3733353131633035630a613766323662373064346663663163636335363363323966316333623437
            31343837386632303832353461356164613765393832306564303937336263316439303237613437
            64356530363661623730306634376666343262353933393161623039383036383565373865633938
            38313065353961633461316464386537393337373034356561623032623534313861373963653431
            63323933393834613366
          HASH_KEY: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            63343939303262306435353137656561613466346631373066373562373438663236336631613836
            3862643064333263326663646333326162383637326231300a653264396135636336386665356638
            39396537616339643737393633386237643262323561653962663561343734663933363635653739
            3566633864633431380a633562333731343338323164613534313861326430353062396638383563
            30306265373761626535366237326336393834333334613935616361656536363831656437333438
            66356139666133633964316538663239376436626363343036386463623933616432306539626366
            32376531626564626235333633613234363337613733333133393462326361336333326662336134
            38316434316465323232
          SESSION_KEY: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            39386230636236613636363964323134653461663662383935623632656161363636653634393735
            6362346635613933636335616161353161333736346637330a313639623533626430393161613732
            66643236353534393235363465333366373332336137346230373830366538653633336138656363
            3565663131643736300a663630633562366331303035663362313536323031313366626661663062
            39303132326634376463326330613430353034383964393937646163373030323530313939326662
            39303061616630366231306630636438633036616261653331653830393464616337346665623230
            62663966313137336139313838326563323930333566396564313761393466376435633937343966
            37636164653563323139
          VEKN_PASSWORD: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            39616533613937346338633764313330613666663562343938313232613532356366343732653461
            3966353738333438636662666563393037383931383735390a336230666533366139376161306164
            30616266323661653831363930663163333332356531666366356636393165646336313138393838
            3665646663343632660a346438306137633833313764343534653366616134636162333931643136
            6664
          DISCORD_CLIENT_SECRET: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            31356337336331623762626239353636336632633261613235306166343864346166343464346665
            3666336366646535623961313961353866363066316136650a616265343833386363323462306132
            64666161353331636332626638376430363062326563623634376231363338653930393463396132
            3139323964346562320a303661656232343039633832663831666636376631393762666565333065
            39343337346266643131646566366238616235646231656637363838643839653738363232353138
            6364353338373435323532396364313333373661326330363364
          MAIL_PASSWORD: !vault |
            $ANSIBLE_VAULT;1.1;AES256
            39623936326432363539633233313461353432303538626363346430316235333030363434303334
            6234643637323536333666333463343465656134383362380a363037313932366136323262323864
            36646666656561396661313636613261326334303931613362623036313432366632613761633264
            3861336162373662620a376430363061316161366332336138346363343634636131353630303632
            32376264653733386136333630633837393561303166393032626237333838626239
